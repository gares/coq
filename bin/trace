#!/bin/sh

usage(){
	echo "usage: $0 (on|off) letters files"
	echo "Example: $0 on DH kernel/conversion.ml kernel/reduction.ml"
	exit 1
}

# This sed line reads the whole file into the pattern space
#    :a; N; $!ba;
# :a is the label, N glues the current line; b branches
# to a if not EOF

if [ $# -lt 3 ]; then usage; fi

ACTION="$1"
FLAGS="`echo $2 | sed 's/\(.\)/\1 /g'`"
shift
shift

case $ACTION in
on) 
	for file in "$@"; do
	       for flag in $FLAGS; do 	
			sed -i '
        		:a; N; $!ba;
			s/(\*'$flag'\* /(*'$flag'<*)/g
			s/ \*'$flag'\*)/(*'$flag'>*)/g
			' $file
		done
	done
;;
off)
	for file in "$@"; do
	       for flag in $FLAGS; do 	
			sed -i '
        		:a; N; $!ba;
			s/(\*'$flag'<\*)/(*'$flag'* /g
			s/(\*'$flag'>\*)/ *'$flag'*)/g
			' $file
		done
	done
;;
*)
	usage
;;
esac
